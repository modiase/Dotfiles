#!/bin/sh

if [ -e "/nix/var/nix/profiles/default/etc/profile.d/nix-daemon.sh" ]; then
  . "/nix/var/nix/profiles/default/etc/profile.d/nix-daemon.sh"
fi
if [ -e "$HOME/.nix-profile/etc/profile.d/nix.sh" ]; then
  . "$HOME/.nix-profile/etc/profile.d/nix.sh"
fi

for cmd in git nix; do
  if ! command -v "$cmd" >/dev/null 2>&1; then
    echo "Error: Required command '$cmd' not found." >&2
    echo "Please ensure git and nix are installed and in your PATH." >&2
    exit 1
  fi
done

if [ "$(uname -s)" = "Darwin" ]; then
  nix shell nixpkgs#home-manager -c home-manager switch --flake .#moye-aarch64-darwin
else
  if [ "$(uname -m)" = "aarch64" ] || [ "$(uname -m)" = "arm64" ]; then
    nix shell nixpkgs#home-manager -c home-manager switch --flake .#moye-aarch64-linux
  else
    nix shell nixpkgs#home-manager -c home-manager switch --flake .#moye-x86_64-linux
  fi
fi
